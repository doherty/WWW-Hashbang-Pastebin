#!/var/www/p.hashbang.ca/perl5/perls/perl-5.16.1/bin/perl
#!/usr/bin/env perl
use strict;
use warnings;
# VERSION
# PODNAME: pastebin
# ABSTRACT: init script for WWW::Hashbang::Pastebin

use Daemon::Control;
use File::Spec;

=head1 SYNOPSIS

    pastebin [start|stop|restart|status]

=for test_synopsis
1;
__END__

=cut

my $run_dir = File::Spec->catdir( File::Spec->rootdir, qw{var run www-data-daemons} );
unless ( -d $run_dir ) {
    mkdir $run_dir;
    chown scalar getpwnam('www-data'), scalar getgrnam('www-data'), $run_dir;
}

$ENV{PLACK_ENV} = 'production';
$ENV{PLACK_SERVER} = 'Starman';

Daemon::Control->new({
    name        => 'pastebin',
    program     => '/var/www/p.hashbang.ca/perl5/perls/perl-5.16.1/bin/plackup',
    program_args=> [
        '-l' => File::Spec->catfile( $run_dir, 'pastebin.sock' ),
        '-a' => '/var/www/p.hashbang.ca/WWW-Hashbang-Pastebin/bin/app.pl',
    ],
    fork        => 2,
    user        => 'www-data',
    group       => 'www-data',
    pid_file    => File::Spec->catfile( $run_dir, 'pastebin.pid' ),
    stdout_file => File::Spec->catfile( $run_dir, 'pastebin.log' ),
    stderr_file => File::Spec->catfile( $run_dir, 'pastebin.log' ),

    lsb_start   => '$nginx',
    lsb_stop    => '$nginx',
    lsb_sdesc   => 'Starts WWW::Hashbang::Pastebin under plackup+Starman',
    lsb_desc    => 'Starts WWW::Hashbang::Pastebin under plackup+Starman',
})->run;
